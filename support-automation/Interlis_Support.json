{
  "name": "Interlis Support",
  "nodes": [
    {
      "parameters": {
        "updates": [
          "messages"
        ],
        "options": {
          "messageStatusUpdates": []
        }
      },
      "id": "8c7ccd89-5500-4ee5-9eb8-9d859cc3ecc6",
      "name": "WhatsApp Trigger",
      "type": "n8n-nodes-base.whatsAppTrigger",
      "position": [
        880,
        1220
      ],
      "webhookId": "d3978cae-2aca-4553-8ac7-ab89068deabc",
      "typeVersion": 1,
      "credentials": {
        "whatsAppTriggerApi": {
          "id": "Jx5TYZIioLlyrFW4",
          "name": "WhatsApp OAuth account"
        }
      }
    },
    {
      "parameters": {
        "url": "={{ $json.url }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {}
      },
      "id": "27f97d2c-d5df-42a2-b1cc-bd097da832ca",
      "name": "Download Image",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        2300,
        1260
      ],
      "typeVersion": 4.2,
      "credentials": {
        "httpHeaderAuth": {
          "id": "Hwxu6rIrs5yfynDo",
          "name": "Header Auth account"
        }
      }
    },
    {
      "parameters": {
        "resource": "image",
        "operation": "analyze",
        "modelId": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini",
          "cachedResultName": "GPT-4O-MINI"
        },
        "text": "=VocÃª Ã© um assistente de IA avanÃ§ado para descriÃ§Ã£o de imagens. Sua funÃ§Ã£o principal Ã© fornecer descriÃ§Ãµes detalhadas e precisas de imagens enviadas pelo WhatsApp.\n\n**FUNCIONALIDADE PRINCIPAL**\n\n* Ao receber uma imagem, vocÃª a analisarÃ¡ minuciosamente e fornecerÃ¡ uma descriÃ§Ã£o abrangente em inglÃªs.\n* Suas descriÃ§Ãµes devem capturar tanto os elementos Ã³bvios quanto os sutis presentes na imagem.\n\n**DIRETRIZES PARA A DESCRIÃ‡ÃƒO DE IMAGENS**\n\n* Comece com uma visÃ£o geral do que a imagem contÃ©m.\n* Descreva os sujeitos, pessoas, objetos principais e suas relaÃ§Ãµes.\n* Observe elementos visuais significativos, como cores, iluminaÃ§Ã£o, composiÃ§Ã£o e perspectiva.\n* Identifique qualquer texto visÃ­vel na imagem.\n* Descreva o cenÃ¡rio ou ambiente.\n* Mencione quaisquer aÃ§Ãµes ou eventos notÃ¡veis que estejam ocorrendo.\n* Comente sobre o humor, tom ou atmosfera, quando relevante.\n* Se aplicÃ¡vel, identifique pontos de referÃªncia, pessoas famosas ou referÃªncias culturais.\n\n**FORMATO DA RESPOSTA**\n\n* Comece com **â€œImage Description:â€** seguido da sua anÃ¡lise.\n* Estruture a descriÃ§Ã£o de forma lÃ³gica (do geral para o especÃ­fico).\n* Use linguagem clara e precisa, adequada para descriÃ§Ã£o visual.\n* Formate descriÃ§Ãµes mais longas em parÃ¡grafos para melhorar a legibilidade.\n* Termine com quaisquer observaÃ§Ãµes notÃ¡veis que possam exigir atenÃ§Ã£o especial.\n\n**LIMITAÃ‡Ã•ES**\n\n* Se a imagem estiver borrada, em baixa resoluÃ§Ã£o ou difÃ­cil de interpretar, reconheÃ§a essas limitaÃ§Ãµes.\n* Se a imagem contiver conteÃºdo potencialmente sensÃ­vel, forneÃ§a uma descriÃ§Ã£o factual sem julgamento.\n* NÃ£o faÃ§a suposiÃ§Ãµes sobre elementos que nÃ£o possam ser claramente determinados.\n\nSuas descriÃ§Ãµes devem ser informativas, objetivas e completas, permitindo que alguÃ©m que nÃ£o vÃª a imagem forme um retrato mental preciso de seu conteÃºdo.\n",
        "inputType": "base64",
        "options": {
          "detail": "auto"
        }
      },
      "id": "49b212c6-0c03-410f-8001-539cac3c2a71",
      "name": "Analyze Image",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "position": [
        2540,
        1260
      ],
      "typeVersion": 1.8,
      "credentials": {
        "openAiApi": {
          "id": "BHXusSEU10unDNKa",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "url": "={{ $json.url }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {}
      },
      "id": "8ca458d3-0472-425b-bac2-c38c6969aa09",
      "name": "Download Audio",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        2300,
        960
      ],
      "typeVersion": 4.2,
      "credentials": {
        "httpHeaderAuth": {
          "id": "Hwxu6rIrs5yfynDo",
          "name": "Header Auth account"
        }
      }
    },
    {
      "parameters": {
        "resource": "audio",
        "operation": "transcribe",
        "options": {}
      },
      "id": "7c23c123-cb18-4671-b6eb-344f7722ea2c",
      "name": "Transcribe Audio",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "position": [
        2540,
        960
      ],
      "typeVersion": 1.8,
      "credentials": {
        "openAiApi": {
          "id": "BHXusSEU10unDNKa",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4.1-mini",
          "mode": "list",
          "cachedResultName": "gpt-4.1-mini"
        },
        "options": {
          "temperature": 0.4
        }
      },
      "id": "a85d5200-77b5-4473-8a04-2916e2c25f91",
      "name": "OpenAI Chat Model",
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "position": [
        1720,
        2420
      ],
      "typeVersion": 1.2,
      "credentials": {
        "openAiApi": {
          "id": "BHXusSEU10unDNKa",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.text }}",
        "options": {
          "systemMessage": "=VocÃª atua como um assistente inteligente de suporte a clienteso. Sua principal funÃ§Ã£o Ã© analisar diferentes tipos de entrada â€” como mensagens de texto, arquivos, imagens e Ã¡udios â€” e fornecer respostas Ãºteis, precisas e contextualizadas Ã s demandas dos usuÃ¡rios. Seu objetivo Ã© oferecer um atendimento eficiente, claro e orientado Ã  resoluÃ§Ã£o de problemas, contribuindo para a melhor experiÃªncia com os sistemas.\n\n\n** ESCOPO DE ATENDIMENTO**\n\nVocÃª foi projetado exclusivamente para oferecer suporte tÃ©cnico relacionado aos seguintes temas:\n\n* Sistemas Interlis\n\n* Sistema MeuExame\n\n* LaboratÃ³rio e equipamentos laboratoriais\n\n* Equipamentos utilizados na operaÃ§Ã£o de um laboratÃ³rio hospitalar ou integraÃ§Ã£o com os sistemas\n\n* Processos e resultados de exames clÃ­nicos, laboratoriais ou operacionais relacionados aos sistemas.\n\n* PorÃ©m seja educado e responta os cumprimentos e agradecimentos.\n\nNÃ£o responda a perguntas que fujam desse escopo. Se o usuÃ¡rio fizer perguntas fora desses temas â€” como assuntos pessoais, curiosidades gerais, humor, ou temas nÃ£o tÃ©cnicos â€” oriente educadamente que este canal Ã© exclusivo para suporte tÃ©cnico.\n\nExemplo de resposta nesses casos:\n\n```\n\"Este canal Ã© exclusivo para suporte tÃ©cnico relacionado ao Interlis, equipamentos e exames. Se precisar de ajuda com isso, estou Ã  disposiÃ§Ã£o.\"\n```\n\n**CAPACIDADES:**\n\n* Processar e responder a mensagens de texto\n* Analisar arquivos enviados\n* Interpretar e descrever imagens\n* Transcrever e compreender mensagens de voz\n\n**TRATAMENTO DAS ENTRADAS:**\n\n1. **Mensagens de texto:** Analisar o conteÃºdo, entender a intenÃ§Ã£o e fornecer uma resposta relevante.\n2. **AnÃ¡lise de arquivos:** Examinar o conteÃºdo do arquivo, extrair as informaÃ§Ãµes principais e resumir os pontos importantes com base tambÃ©m nas perguntas feitas.\n3. **AnÃ¡lise de imagens:** Descrever o que estÃ¡ visÃ­vel na imagem, identificar os elementos-chave e responder a eventuais perguntas sobre a imagem.\n4. **Mensagens de voz:** Transcrever o Ã¡udio, compreender a mensagem e responder de forma apropriada.\n\n**DIRETRIZES DE RESPOSTA:**\n\n* Seja conciso, mas completo\n* Priorize a precisÃ£o em vez de suposiÃ§Ãµes\n* Mantenha um tom profissional e prestativo\n* ReconheÃ§a limitaÃ§Ãµes quando houver incerteza\n* Formate as respostas para facilitar a leitura em dispositivos mÃ³veis\n* Inclua informaÃ§Ãµes acionÃ¡veis quando apropriado\n* Se nÃ£o for especificado, o usuÃ¡rio estÃ¡ perguntando sobre o Interlis.\n* Tudo bem ser descontraido, mas mantenha o foco no suporte tÃ©cnico.\n\n**LIMITAÃ‡Ã•ES:**\n\n* Mencione se nÃ£o puder processar determinados formatos de arquivo\n* Indique se a imagem estiver desfocada ou com detalhes difÃ­ceis de discernir\n* Alerte se a qualidade do Ã¡udio impactar a precisÃ£o da transcriÃ§Ã£o\n\n**SEGURANÃ‡A E PRIVACIDADE:**\n\n* NÃ£o armazene nem memorize informaÃ§Ãµes sensÃ­veis compartilhadas em arquivos, imagens ou Ã¡udios\n* NÃ£o compartilhe informaÃ§Ãµes pessoais entre diferentes interaÃ§Ãµes de usuÃ¡rios\n* Informe os usuÃ¡rios sobre as limitaÃ§Ãµes de privacidade de dados quando relevante\n\nAnalise cuidadosamente todas as entradas antes de responder. Seu objetivo Ã© gerar valor por meio de informaÃ§Ãµes precisas e assistÃªncia Ãºtil.\n\n** Output **\n* Toda saÃ­da de texto deverÃ¡ ser formatada para texto puro, limpando eventual formataÃ§Ã£o Markdown e/ou Html por exemplo."
        }
      },
      "id": "8386dc00-4a2d-4f8e-8c92-140e3b0e2453",
      "name": "AI Agent1",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        1760,
        2200
      ],
      "typeVersion": 1.8
    },
    {
      "parameters": {
        "url": "={{ $json.url }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {}
      },
      "id": "8cf4d6db-2322-4c5e-9a8b-c0398a78c48f",
      "name": "Download File",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        2300,
        1600
      ],
      "typeVersion": 4.2,
      "credentials": {
        "httpHeaderAuth": {
          "id": "Hwxu6rIrs5yfynDo",
          "name": "Header Auth account"
        }
      }
    },
    {
      "parameters": {
        "operation": "pdf",
        "options": {}
      },
      "id": "45cd339f-4cb4-4b5d-800c-00f80ab4291f",
      "name": "Extract from File",
      "type": "n8n-nodes-base.extractFromFile",
      "position": [
        2560,
        1600
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "resource": "media",
        "operation": "mediaUrlGet",
        "mediaGetId": "={{ $('WhatsApp Trigger').item.json.messages[0].document.id }}"
      },
      "id": "d8687cdb-d94d-429e-91ec-7af6d146b7b5",
      "name": "Get File Url",
      "type": "n8n-nodes-base.whatsApp",
      "position": [
        2080,
        1600
      ],
      "webhookId": "280bd5de-32d7-4d8f-93d2-e91e3b0bc161",
      "typeVersion": 1,
      "credentials": {
        "whatsAppApi": {
          "id": "aokWnRlufIEjNCV1",
          "name": "WhatsApp account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "f52d2aaa-e0b2-45e5-8c4b-ceef42182a0d",
              "operator": {
                "name": "filter.operator.equals",
                "type": "string",
                "operation": "equals"
              },
              "leftValue": "={{ $json.messages[0].document.mime_type }}",
              "rightValue": "application/pdf"
            }
          ]
        },
        "options": {}
      },
      "id": "fb1481bc-5a51-41a6-8d2f-84bf2b01e05c",
      "name": "Only PDF File",
      "type": "n8n-nodes-base.if",
      "position": [
        1800,
        1620
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "jsCode": "for (const item of $input.all()) {\n  if (item.binary) {\n    const binaryPropertyNames = Object.keys(item.binary);\n    for (const propName of binaryPropertyNames) {\n      if (item.binary[propName].mimeType === 'audio/mp3') {\n        item.binary[propName].mimeType = 'audio/mpeg';\n      }\n    }\n  }\n}\n\nreturn $input.all();"
      },
      "id": "7bd98b54-584a-4cc5-9558-faf832baec6f",
      "name": "Fix mimeType for Audio",
      "type": "n8n-nodes-base.code",
      "position": [
        2660,
        2080
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "operation": "send",
        "phoneNumberId": "620856557788335",
        "recipientPhoneNumber": "={{ $('WhatsApp Trigger').item.json.messages[0].from }}",
        "textBody": "={{ $json.output }}",
        "additionalFields": {}
      },
      "id": "ac2c2572-8825-4c46-b1f7-58a834d9f0de",
      "name": "Send message",
      "type": "n8n-nodes-base.whatsApp",
      "position": [
        2460,
        2360
      ],
      "webhookId": "23834751-5066-48ba-8e19-549680df2b27",
      "typeVersion": 1,
      "credentials": {
        "whatsAppApi": {
          "id": "aokWnRlufIEjNCV1",
          "name": "WhatsApp account"
        }
      }
    },
    {
      "parameters": {
        "operation": "send",
        "phoneNumberId": "620856557788335",
        "recipientPhoneNumber": "={{ $('WhatsApp Trigger').item.json.messages[0].from }}",
        "messageType": "audio",
        "mediaPath": "useMedian8n",
        "additionalFields": {}
      },
      "id": "90655906-f676-4ca4-90af-df9547016d9d",
      "name": "Send audio",
      "type": "n8n-nodes-base.whatsApp",
      "position": [
        2880,
        2080
      ],
      "webhookId": "d18b2c98-84e4-43cf-a532-0c47d5161684",
      "typeVersion": 1,
      "credentials": {
        "whatsAppApi": {
          "id": "aokWnRlufIEjNCV1",
          "name": "WhatsApp account"
        }
      }
    },
    {
      "parameters": {
        "operation": "send",
        "phoneNumberId": "728907270295083",
        "recipientPhoneNumber": "={{ $('WhatsApp Trigger').item.json.messages[0].from }}",
        "textBody": "=Desculpe, mas vocÃª sÃ³ pode enviar arquivos no formato PDF.",
        "additionalFields": {}
      },
      "id": "1072e307-43dc-4275-aade-4a4dd58ef4be",
      "name": "Incorrect format",
      "type": "n8n-nodes-base.whatsApp",
      "position": [
        2080,
        1800
      ],
      "webhookId": "23834751-5066-48ba-8e19-549680df2b27",
      "typeVersion": 1,
      "credentials": {
        "whatsAppApi": {
          "id": "aokWnRlufIEjNCV1",
          "name": "WhatsApp account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c53cd9f9-77c1-4331-98ff-bfc9bdf95a3c",
              "name": "text",
              "type": "string",
              "value": "={{ $('WhatsApp Trigger').item.json.messages[0].text.body }}"
            }
          ]
        },
        "options": {}
      },
      "id": "7c8f044d-8100-4476-adb1-90e8a657d767",
      "name": "Text",
      "type": "n8n-nodes-base.set",
      "position": [
        2380,
        600
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "219577d5-b028-48fc-90be-980f4171ab68",
              "name": "text",
              "type": "string",
              "value": "={{ $json.text }}"
            }
          ]
        },
        "options": {}
      },
      "id": "03408e5f-efef-4089-84a1-7d9145fff583",
      "name": "Audio",
      "type": "n8n-nodes-base.set",
      "position": [
        2820,
        960
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "67552183-de2e-494a-878e-c2948e8cb6bb",
              "name": "text",
              "type": "string",
              "value": "=User request on the image:\n{{ \"Describe the following image\" || $('WhatsApp Trigger').item.json.messages[0].image.caption }}\n\nImage description:\n{{ $json.content }}"
            }
          ]
        },
        "options": {}
      },
      "id": "1bbdd28f-7e6c-43e1-a91d-5c67b28e71b2",
      "name": "Image",
      "type": "n8n-nodes-base.set",
      "position": [
        2800,
        1260
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "67552183-de2e-494a-878e-c2948e8cb6bb",
              "name": "text",
              "type": "string",
              "value": "=User request on the file:\n{{ \"Describe this file\" || $('Only PDF File').item.json.messages[0].document.caption }}\n\nFile content:\n{{ $json.text }}"
            }
          ]
        },
        "options": {}
      },
      "id": "34ae04ad-ba65-4532-b7ab-2bf8af2bcec4",
      "name": "File",
      "type": "n8n-nodes-base.set",
      "position": [
        2820,
        1600
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "operation": "send",
        "phoneNumberId": "728907270295083",
        "recipientPhoneNumber": "={{ $('WhatsApp Trigger').item.json.messages[0].from }}",
        "textBody": "=VocÃª sÃ³ pode enviar mensagens de texto, imagens, arquivos de Ã¡udio e documentos em PDF.",
        "additionalFields": {}
      },
      "id": "7d5c448b-7cf4-4867-aaa3-395bc8354e5b",
      "name": "Not supported",
      "type": "n8n-nodes-base.whatsApp",
      "position": [
        1280,
        1440
      ],
      "webhookId": "23834751-5066-48ba-8e19-549680df2b27",
      "typeVersion": 1,
      "credentials": {
        "whatsAppApi": {
          "id": "aokWnRlufIEjNCV1",
          "name": "WhatsApp account"
        }
      }
    },
    {
      "parameters": {
        "resource": "media",
        "operation": "mediaUrlGet",
        "mediaGetId": "={{ $('WhatsApp Trigger').item.json.messages[0].image.id }}"
      },
      "id": "99124b0f-cbd6-471a-a3ba-5fa49802c059",
      "name": "Get Image Url",
      "type": "n8n-nodes-base.whatsApp",
      "position": [
        2060,
        1260
      ],
      "webhookId": "280bd5de-32d7-4d8f-93d2-e91e3b0bc161",
      "typeVersion": 1,
      "credentials": {
        "whatsAppApi": {
          "id": "aokWnRlufIEjNCV1",
          "name": "WhatsApp account"
        }
      }
    },
    {
      "parameters": {
        "resource": "media",
        "operation": "mediaUrlGet",
        "mediaGetId": "={{ $('WhatsApp Trigger').item.json.messages[0].audio.id }}"
      },
      "id": "9cda7027-d256-4d38-aa09-30ab300da35e",
      "name": "Get Audio Url",
      "type": "n8n-nodes-base.whatsApp",
      "position": [
        2040,
        960
      ],
      "webhookId": "87caa300-7204-47b5-959a-94f4a8fbf8cf",
      "typeVersion": 1,
      "credentials": {
        "whatsAppApi": {
          "id": "aokWnRlufIEjNCV1",
          "name": "WhatsApp account"
        }
      }
    },
    {
      "parameters": {
        "resource": "audio",
        "model": "tts-1-hd",
        "input": "={{ $('AI Agent1').item.json.output }}",
        "voice": "nova",
        "options": {}
      },
      "id": "5f823838-a619-4c20-87d8-cfa503a4af4d",
      "name": "Generate Audio Response",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "position": [
        2460,
        2080
      ],
      "typeVersion": 1.8,
      "credentials": {
        "openAiApi": {
          "id": "BHXusSEU10unDNKa",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "content": "## Text",
        "height": 280,
        "width": 1340
      },
      "id": "d715c641-a858-4802-8046-7f1e74e3680f",
      "name": "Sticky Note",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1700,
        540
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## Voice",
        "height": 300,
        "width": 1340
      },
      "id": "2f89ede8-2f8a-4b5c-a092-27c3a13a682f",
      "name": "Sticky Note1",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1700,
        860
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## Image",
        "height": 260,
        "width": 1340
      },
      "id": "793a881f-0df7-4d59-9777-9bad4864d39d",
      "name": "Sticky Note2",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1700,
        1200
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## Document",
        "height": 500,
        "width": 1340
      },
      "id": "4f60c92c-8204-4d71-ad0d-e6f577e4b1fd",
      "name": "Sticky Note3",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1700,
        1500
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## Response",
        "height": 720,
        "width": 1340,
        "color": 5
      },
      "id": "e7f14eb8-471c-4fca-a90a-eceeec6757f6",
      "name": "Sticky Note4",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1700,
        2020
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "combinator": "and",
          "conditions": [
            {
              "id": "b9d1d759-f585-4791-a743-b9d72951e77c",
              "operator": {
                "type": "object",
                "operation": "exists",
                "singleValue": true
              },
              "leftValue": "={{ $('WhatsApp Trigger').item.json.messages[0].audio }}",
              "rightValue": ""
            }
          ]
        },
        "options": {}
      },
      "id": "cd7d8589-4abe-4334-a93d-c3967b60aace",
      "name": "From audio to audio?",
      "type": "n8n-nodes-base.if",
      "position": [
        2140,
        2200
      ],
      "typeVersion": 2.2
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "version": 2,
                  "leftValue": "",
                  "caseSensitive": true,
                  "typeValidation": "strict"
                },
                "combinator": "and",
                "conditions": [
                  {
                    "id": "08fd0c80-307e-4f45-b1de-35192ee4ec5e",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    },
                    "leftValue": "={{ $json.messages[0].text.body }}",
                    "rightValue": ""
                  }
                ]
              },
              "renameOutput": true,
              "outputKey": "Text"
            },
            {
              "conditions": {
                "options": {
                  "version": 2,
                  "leftValue": "",
                  "caseSensitive": true,
                  "typeValidation": "strict"
                },
                "combinator": "and",
                "conditions": [
                  {
                    "id": "b7b64446-f1ea-4622-990c-22f3999a8269",
                    "operator": {
                      "type": "object",
                      "operation": "exists",
                      "singleValue": true
                    },
                    "leftValue": "={{ $json.messages[0].audio }}",
                    "rightValue": ""
                  }
                ]
              },
              "renameOutput": true,
              "outputKey": "Voice"
            },
            {
              "conditions": {
                "options": {
                  "version": 2,
                  "leftValue": "",
                  "caseSensitive": true,
                  "typeValidation": "strict"
                },
                "combinator": "and",
                "conditions": [
                  {
                    "id": "202af928-a324-411a-bf15-68a349e7bf9e",
                    "operator": {
                      "type": "object",
                      "operation": "exists",
                      "singleValue": true
                    },
                    "leftValue": "={{ $json.messages[0].image }}",
                    "rightValue": ""
                  }
                ]
              },
              "renameOutput": true,
              "outputKey": "Image"
            },
            {
              "conditions": {
                "options": {
                  "version": 2,
                  "leftValue": "",
                  "caseSensitive": true,
                  "typeValidation": "strict"
                },
                "combinator": "and",
                "conditions": [
                  {
                    "id": "c63299e9-6069-4bc6-afb9-7beebf6e3d69",
                    "operator": {
                      "type": "object",
                      "operation": "exists",
                      "singleValue": true
                    },
                    "leftValue": "={{ $json.messages[0].document }}",
                    "rightValue": ""
                  }
                ]
              },
              "renameOutput": true,
              "outputKey": "Document"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "1613be17-9508-442d-ba4b-1de30d949b79",
      "name": "Input type",
      "type": "n8n-nodes-base.switch",
      "position": [
        1100,
        1180
      ],
      "typeVersion": 3.2
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "=whatsapp_memory_{{ $('WhatsApp Trigger').item.json.contacts[0].wa_id }}",
        "contextWindowLength": 20
      },
      "type": "@n8n/n8n-nodes-langchain.memoryRedisChat",
      "typeVersion": 1.5,
      "position": [
        1880,
        2420
      ],
      "id": "c804cbe5-0412-4b6b-8b75-6396b00948a2",
      "name": "Redis Chat Memory",
      "credentials": {
        "redis": {
          "id": "JqrRuD7cIH8tLmov",
          "name": "Redis Production"
        }
      }
    },
    {
      "parameters": {
        "operation": "push",
        "list": "=whatsapp_user_msg_{{ $('WhatsApp Trigger').item.json.contacts[0].wa_id }}",
        "messageData": "={{ $('WhatsApp Trigger').item.json.messages[0].text.body }}"
      },
      "type": "n8n-nodes-base.redis",
      "typeVersion": 1,
      "position": [
        2660,
        600
      ],
      "id": "4a596c9b-d25b-4223-87da-57620c849ae2",
      "name": "Save Msg Historic",
      "credentials": {
        "redis": {
          "id": "JqrRuD7cIH8tLmov",
          "name": "Redis Production"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "content": "How to obtain Whatsapp API?\n\n\n### âœ… Prerequisites\nBefore you begin, make sure you have:\n- A **Meta Business Account**\n- A **Facebook Developer Account**\n- A **Verified Business**\n- A **Phone Number** to link to WhatsApp\n- Access to **Meta's Graph API Explorer** or **Meta for Developers portal**\n\n---\n\n### ðŸªœ STEP 1: Create a Meta App\n\n1. Go to [https://developers.facebook.com/apps](https://developers.facebook.com/apps)\n2. Click **â€œCreate Appâ€**\n3. Choose **\"Business\"** as the app type, then click **Next**\n4. Give your app a name and enter a contact email\n5. Choose your Business Account (or create one)\n6. Click **Create App**\n\n---\n\n### ðŸªœ STEP 2: Add WhatsApp Product\n\n1. In your app dashboard, scroll down to **\"Add a Product\"**\n2. Find **\"WhatsApp\"** and click **â€œSet Upâ€**\n3. Link your **Business Manager Account**\n\n---\n\n### ðŸªœ STEP 3: Create a WhatsApp Business Account (if needed)\n\n1. If you havenâ€™t already, go to [https://business.facebook.com/](https://business.facebook.com/)\n2. Click **â€œCreate Accountâ€**, and complete your business information\n3. Go to **Business Settings > Accounts > WhatsApp Accounts**\n4. Add a **Phone Number** (you'll receive a verification code)\n\n---\n\n### ðŸªœ STEP 4: Generate a Temporary Access Token (for development)\n\n1. In the **App Dashboard**, go to **WhatsApp > Getting Started**\n2. Choose your test phone number\n3. Copy the **temporary access token** (valid for 24 hours)\n4. Copy the **Phone Number ID** and **WhatsApp Business Account ID**\n\nâœ… Save these 3 values:\n- **Access Token**\n- **Phone Number ID**\n- **WABA ID**\n\nðŸ“ Tip: For production, you will later need to create a **permanent token** (see step 7).\n\n---\n\n### ðŸªœ STEP 5: Set Up a Webhook URL (n8n)\n\n1. In n8n, set up a **Webhook node** (or use the `WhatsApp Trigger` node)\n2. Copy the webhook URL\n3. In the Meta Developer Dashboard:\n   - Go to **WhatsApp > Configuration**\n   - Click **â€œEdit Callback URLâ€**\n   - Paste your n8n webhook URL and add a random **verify token**\n4. In n8n, configure your webhook to respond to the verification request\n\n---\n\n### ðŸªœ STEP 6: Subscribe to Webhook Fields\n\n1. Still under **WhatsApp > Configuration**, click **\"Manage Subscriptions\"**\n2. Enable:\n   - `messages`\n   - `message_status`\n   - (Optionally `message_template_status_update`)\n\n---\n\n### ðŸªœ STEP 7: (Optional but recommended) Generate a Permanent Token\n\n1. Go to [https://developers.facebook.com/tools/access_token/](https://developers.facebook.com/tools/access_token/)\n2. Select your app\n3. Click **Get Token > System User Token**\n4. Select the permissions:\n   - `whatsapp_business_management`\n   - `whatsapp_business_messaging`\n   - `business_management`\n5. Click **Generate Token**\n6. Copy and securely store this token\n\n---\n\n### ðŸªœ STEP 8: Configure Credentials in n8n\n\n1. Go to **n8n > Settings > Credentials**\n2. Create new credentials of type **HTTP Header Auth**\n   - **Name:** WhatsApp\n   - **Header Name:** `Authorization`\n   - **Value:** `Bearer <your_access_token>`\n3. Save\n\nThen, in your workflows:\n- Use the HTTP Request node or WhatsApp node\n- Set the `phone_number_id` in the node parameters\n- Connect it to your WhatsApp credential\n\n---\n\n### ðŸ§ª STEP 9: Test the Connection\n\n1. Use a WhatsApp number to send a message to your business phone\n2. Your n8n workflow should be triggered\n3. You can now send and receive messages programmatically ðŸŽ‰\n",
        "height": 2680,
        "width": 780,
        "color": 3
      },
      "id": "f5f7ad66-0bb9-4f5e-9ed1-7345ab5921e5",
      "name": "Sticky Note7",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -180,
        1080
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "content": "## Knowledge Base",
        "height": 720,
        "width": 1340,
        "color": 5
      },
      "id": "850d1caf-3502-41b5-a76b-42bacb267d29",
      "name": "Sticky Note5",
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1700,
        2780
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolName": "release_list_interlis_meuexame",
        "toolDescription": "Lista de Reelases: Interlis e MeuExame",
        "tableName": "f4g_vectors_releases",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePGVector",
      "typeVersion": 1.1,
      "position": [
        2280,
        2940
      ],
      "id": "863b6478-fb91-47c9-8208-10b3b188c43d",
      "name": "List Releases",
      "credentials": {
        "postgres": {
          "id": "oHM829iBP7fNgt5E",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        2240,
        3140
      ],
      "id": "f0f6b0a6-fadb-42f3-a831-7c5b74e42e5a",
      "name": "Embeddings OpenAI",
      "credentials": {
        "openAiApi": {
          "id": "BHXusSEU10unDNKa",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolName": "base_de_conhecimento_interlis",
        "toolDescription": "Base de Conhecimento Sistema Interlis",
        "tableName": "f4g_vectors_docs",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePGVector",
      "typeVersion": 1.1,
      "position": [
        1940,
        2940
      ],
      "id": "7a54861f-3f07-46cd-82d5-712f3cf21640",
      "name": "KB Interlis",
      "credentials": {
        "postgres": {
          "id": "oHM829iBP7fNgt5E",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        1900,
        3140
      ],
      "id": "11f3cd89-ae72-46ec-b6f9-23006f6d7663",
      "name": "Embeddings OpenAI2",
      "credentials": {
        "openAiApi": {
          "id": "BHXusSEU10unDNKa",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1.2,
      "position": [
        2500,
        3180
      ],
      "id": "6f367fe1-d1d8-4eb8-a43d-d222c94915fe",
      "name": "Embeddings OpenAI1",
      "credentials": {
        "openAiApi": {
          "id": "BHXusSEU10unDNKa",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolName": "documetantion_equipament_labs",
        "toolDescription": "Base de Conhecimento Das OperaÃ§Ãµes da MÃ¡quinas de laboratÃ³rio",
        "tableName": "f4g_vectors_machine_docs",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePGVector",
      "typeVersion": 1.1,
      "position": [
        2580,
        2940
      ],
      "id": "f5d353ea-7a76-4329-b409-606502e4616a",
      "name": "KB Equipment",
      "credentials": {
        "postgres": {
          "id": "oHM829iBP7fNgt5E",
          "name": "Postgres account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "File": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Text": {
      "main": [
        [
          {
            "node": "Save Msg Historic",
            "type": "main",
            "index": 0
          },
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Audio": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Image": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent1": {
      "main": [
        [
          {
            "node": "From audio to audio?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Input type": {
      "main": [
        [
          {
            "node": "Text",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Audio Url",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get Image Url",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Only PDF File",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Not supported",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get File Url": {
      "main": [
        [
          {
            "node": "Download File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analyze Image": {
      "main": [
        [
          {
            "node": "Image",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download File": {
      "main": [
        [
          {
            "node": "Extract from File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Audio Url": {
      "main": [
        [
          {
            "node": "Download Audio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Image Url": {
      "main": [
        [
          {
            "node": "Download Image",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Only PDF File": {
      "main": [
        [
          {
            "node": "Get File Url",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Incorrect format",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download Audio": {
      "main": [
        [
          {
            "node": "Transcribe Audio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Download Image": {
      "main": [
        [
          {
            "node": "Analyze Image",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Transcribe Audio": {
      "main": [
        [
          {
            "node": "Audio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "WhatsApp Trigger": {
      "main": [
        [
          {
            "node": "Input type",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract from File": {
      "main": [
        [
          {
            "node": "File",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "From audio to audio?": {
      "main": [
        [
          {
            "node": "Generate Audio Response",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fix mimeType for Audio": {
      "main": [
        [
          {
            "node": "Send audio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Audio Response": {
      "main": [
        [
          {
            "node": "Fix mimeType for Audio",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Save Msg Historic": {
      "main": [
        []
      ]
    },
    "List Releases": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI": {
      "ai_embedding": [
        [
          {
            "node": "List Releases",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "KB Interlis": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI2": {
      "ai_embedding": [
        [
          {
            "node": "KB Interlis",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings OpenAI1": {
      "ai_embedding": [
        [
          {
            "node": "KB Equipment",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "KB Equipment": {
      "ai_tool": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "timezone": "America/Sao_Paulo",
    "callerPolicy": "workflowsFromSameOwner"
  },
  "versionId": "ad6f94db-89df-4e9b-bb60-b227d39616cb",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "680b771266285e0b2805aa12c56e24ddd5aa291181c2c29d2ca50bff81261932"
  },
  "id": "AI0Wt487lx4Ad3f8",
  "tags": []
}